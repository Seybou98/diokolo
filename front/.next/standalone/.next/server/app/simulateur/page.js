(()=>{var e={};e.id=1079,e.ids=[1079],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},9523:e=>{"use strict";e.exports=require("dns")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},85158:e=>{"use strict";e.exports=require("http2")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},79674:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>p,originalPathname:()=>c,pages:()=>d,routeModule:()=>x,tree:()=>a}),r(61383),r(60108),r(12523);var s=r(23191),i=r(88716),n=r(37922),o=r.n(n),l=r(95231),u={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(u[e]=()=>l[e]);r.d(t,u);let a=["",{children:["simulateur",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,61383)),"C:\\Users\\Reunion2\\Desktop\\test-pay\\front\\src\\app\\simulateur\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,60108)),"C:\\Users\\Reunion2\\Desktop\\test-pay\\front\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,12523)),"C:\\Users\\Reunion2\\Desktop\\test-pay\\front\\src\\app\\not-found.tsx"]}],d=["C:\\Users\\Reunion2\\Desktop\\test-pay\\front\\src\\app\\simulateur\\page.tsx"],c="/simulateur/page",p={require:r,loadChunk:()=>Promise.resolve()},x=new s.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/simulateur/page",pathname:"/simulateur",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:a}})},73848:(e,t,r)=>{Promise.resolve().then(r.bind(r,35581))},35581:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>$});var s=r(10326),i=r(7369),n=r(44976),o=r(10119),l=r(32873),u=r(50128),a=r(6550),d=r(76),c=r(29809),p=r(35047);let x=new Set;var m=r(11938),h=r(25408),g=r(17577),f=r(62841),y=r(38875),b=r(27790),j=r(78339),v=r(34677),S=r(83162),C=r(72234),q=r(88945);function w(e){let{options:t,onNext:r,isMulti:i,values:n,onChange:o}=e;return s.jsx(C.g,{spacing:10,children:t.map(({values:e,title:t},l)=>(0,s.jsxs)(m.xu,{children:[t&&s.jsx(b.x,{fontWeight:800,fontSize:18,color:"king",children:t}),s.jsx(q.E,{justify:"center",children:e.map(({id:e,title:t,icon:l,subtitle:u})=>{let a=n.includes(e);return s.jsx(q.U,{w:{base:"full",md:"unset"},children:(0,s.jsxs)(j.M,{cursor:"pointer",borderWidth:1,...n.includes(e)&&{borderColor:"primary"},onClick:()=>(function(e){if(i){let t=n;o(t=n.includes(e)?t.filter(t=>t!=e):[...t,e])}else o([e]),r([e])})(e),w:{base:"full",md:"200px"},maxW:{base:"350px",md:"unset"},h:{md:"180px"},bg:"white",boxShadow:{base:S.k,md:S.A},m:{base:1,md:5},mx:{base:"auto",md:"unset"},flexDir:{md:"column"},py:{base:2,md:6},px:{base:3,md:4},rounded:"md",position:"relative",...a&&{bg:"primaryLight",borderColor:"primary"},justifyContent:{base:"flex-start",md:"center"},children:[l&&s.jsx(y.E,{src:l,h:"50px"}),s.jsx(b.x,{mt:{md:2},ml:{base:2,md:0},userSelect:"none",textAlign:{base:"left",md:"unset"},children:t}),s.jsx(m.xu,{position:{md:"absolute"},rounded:"full",boxSize:"25px",minW:"25px",borderWidth:1,bg:"white",borderColor:"king",top:{md:2},ml:{base:"auto",md:"unset"},right:2,...a&&{borderColor:"primary",bg:"primary"}})]})},e)})})]},l))})}var E=r(47952),I=r(82609),k=r(74723),A=r(6331),N=r(39776);function D(e,t){return e.find(e=>e.id==t.id)?[...e.filter(e=>e.id!=t.id),t]:[...e,t]}var P=r(86514);r(4204);var R=r(42929);function U(e){let{simulatorResult:t,onEnd:r,...i}=e,[n,o]=(0,g.useState)(!1),[l,u]=(0,g.useState)();return l&&!n?(0,s.jsxs)(m.xu,{pb:10,children:[s.jsx(b.x,{fontWeight:800,fontSize:20,mb:8,children:"Acc\xe9dez \xe0 votre estimation sur votre espace s\xe9curis\xe9"}),"signup"==l&&(0,s.jsxs)(s.Fragment,{children:[s.jsx(N.Z,{defaultAddress:function(e){let t=e.find(e=>"adresse"==e.id);try{if(t)return JSON.parse(t.value.toString())}catch(e){console.error(e)}return null}(t)??void 0,onEnd:()=>{r(),o(!0)},...i}),s.jsx(b.x,{mt:10,mb:2,textAlign:"left",fontSize:18,fontWeight:500,color:"gray.500",children:"D\xe9j\xe0 un compte ?"}),s.jsx(v.default,{onClick:()=>u("login"),children:"Me connecter"})]}),"login"==l&&(0,s.jsxs)(s.Fragment,{children:[s.jsx(R.Z,{mx:"auto",onSuccess:()=>{r(),o(!0)},displayForgotPassword:!1}),s.jsx(b.x,{mt:10,mb:2,textAlign:"left",fontSize:18,fontWeight:500,color:"gray.500",children:"Pas encore de compte ?"}),s.jsx(v.default,{onClick:()=>u("signup"),children:"Cr\xe9er mon compte"})]})]}):s.jsx(P.Z,{h:"full",children:"Enregistrement de votre simulation..."})}let _=["input-number","input-moreless","input-address","input-text","select-multi"];function z(e){let{id:t,title:r,type:i,bigTitle:n,label:o,mask:l,max:u,onNext:d,onPrevious:c,subtitle:p,tag:x,values:j,valuesSection:v,displayOnNext:S=!1,defaultValue:C,simulatorResult:q,onEnd:N}=e,[D,P]=(0,g.useState)(C??""),R=(0,k.cI)();return(0,s.jsxs)(h.k,{alignItems:"center",flexDir:"column",h:"full",px:{base:5,lg:10},children:[c&&(0,s.jsxs)(f.U,{position:"fixed",top:{base:"90px",lg:"130px"},left:0,onClick:c,cursor:"pointer",zIndex:1,bg:"white",px:5,py:1,rounded:"full",children:[s.jsx(y.E,{src:"/icons/fleche.png",w:"25px",transform:"rotate(180deg)"}),s.jsx(b.x,{fontWeight:700,color:"primary",userSelect:"none",children:"Retour"})]}),x&&s.jsx(b.x,{bg:"primaryLight",color:"primary",fontWeight:600,py:4,px:{base:10,lg:20},w:"fit-content",rounded:"full",children:x}),n&&s.jsx(b.x,{as:"h1",my:10,fontSize:{base:25,lg:35},fontWeight:800,children:n}),(0,s.jsxs)(m.xu,{mt:{base:n?10:"70px",md:n?10:20},mb:8,children:[r&&s.jsx(b.x,{fontWeight:800,fontSize:20,mb:3,children:r}),p&&s.jsx(b.x,{color:"gray.400",fontWeight:500,children:p})]}),["signup"].includes(i)&&s.jsx(U,{mt:4,simulatorResult:q.map(e=>({...e,value:Array.isArray(e.value)?e.value.map(e=>e.toString()):[e.value.toString()]})),onEnd:async()=>{try{let e=a.I.currentUser;if(!e)throw Error("Authentication required");await e.getIdToken(!0),N()}catch(e){console.error("Submission error:",e)}}}),(0,s.jsxs)(m.xu,{as:I.l0,h:"full",form:R,w:"100%",position:"relative",onSubmit:()=>{D&&(!Array.isArray(D)||D.length>0)&&d(D)},children:[["select","select-multi"].includes(i)&&(()=>{let e=void 0!=u&&D.length>u;return(0,s.jsxs)(s.Fragment,{children:[s.jsx(w,{options:(j?[{values:j}]:v)??[],isMulti:"select-multi"==i,onNext:d,values:D??[],onChange:e=>P(e)}),"select-multi"==i&&s.jsx(O,{onClick:()=>d(D),isDisabled:D.length<1||e,error:e?`Vous pouvez choisir au maximum ${u} \xe9l\xe9ments`:void 0,children:"CONTINUER"})]})})(),["input-number","input-moreless"].includes(i)&&(0,s.jsxs)(s.Fragment,{children:[s.jsx(E.I,{label:o,value:D.toString(),type:"number",onChange:e=>{P(e.target.value)}}),s.jsx(O,{onClick:()=>d(D),isDisabled:isNaN(parseInt(D.toString()))||0>=parseInt(D.toString()),children:"CONTINUER"})]}),["input-text"].includes(i)&&(0,s.jsxs)(s.Fragment,{children:[s.jsx(E.I,{label:o,value:D.toString(),onChange:e=>{P(e.currentTarget.value)}}),s.jsx(O,{onClick:()=>d(D),isDisabled:D.toString().length<1,children:"CONTINUER"})]}),["input-address"].includes(i)&&(()=>{let e;try{let t=JSON.parse(D.toString());t?.address&&(e=t)}catch{}return(0,s.jsxs)(s.Fragment,{children:[s.jsx(A.r,{label:o,value:e,onChangeValue:e=>{P(JSON.stringify(e))}}),s.jsx(O,{onClick:()=>d(D),isDisabled:!e,children:"CONTINUER"})]})})(),d&&S&&!_.includes(i)&&s.jsx(O,{onClick:()=>d(),children:"CONTINUER"})]})]})}function O(e){let{error:t,...r}=e;return(0,s.jsxs)(j.M,{flexDir:"column",my:{base:3,lg:3},children:[t&&s.jsx(b.x,{color:"red",my:1,top:5,children:t}),s.jsx(v.default,{...r,children:"CONTINUER"})]})}var W=r(62203);function F(e){let{progress:t}=e;return s.jsx(m.xu,{position:"fixed",top:{base:"60px",lg:"100px"},left:0,right:0,h:"10px",zIndex:1,children:s.jsx(m.xu,{h:"full",w:`${Math.max(Math.min(100,100*t),1)}%`,bgGradient:"linear(to-r,secondary,primary)",roundedRight:"full",transition:"all .4s"})})}let M=[];function T(){let e=(0,p.useRouter)(),{data:t,isLoading:r}=(0,i.useQuery)({queryKey:l.a.tree(),queryFn:async()=>{try{let e=await a.I.currentUser?.getIdToken();console.log("API URL:","https://label-energie-api.onrender.com");let{data:t}=await u.hi.get("/simulator/tree",{headers:e?{Authorization:`Bearer ${e}`}:{}});return t}catch(e){throw console.error("Failed to fetch simulator tree:",e),e}},staleTime:3e5,retry:2}),{mutate:f}=function(){let e=(0,n.useQueryClient)(),t=(0,p.useRouter)();return(0,o.useMutation)({mutationFn:async e=>{let t=Date.now().toString();if(x.size>0)throw Error("Une op\xe9ration est d\xe9j\xe0 en cours");x.add(t);try{let t=a.I.currentUser;if(!t)throw Error("User not authenticated");let r=new Date,s={name:`Simulation ${r.toLocaleDateString("fr-FR")}`,userId:t.uid,status:{id:c.S.Pending,label:"En attente",color:"#FFA500"},products:e.simulation.map(e=>({id:e.id,type:e.type,value:Array.isArray(e.value)?e.value:[e.value]})),documents:[],date:r,createdAt:r.toISOString(),updatedAt:r.toISOString()};return(await (0,d.ET)((0,d.hJ)(a.db,"folders"),s)).id}finally{x.delete(t)}},onSuccess:r=>{e.invalidateQueries({queryKey:l.Wg.list(),exact:!0}),console.log("Dossier cr\xe9\xe9 avec succ\xe8s:",r),t.push("/app/mon-compte/mes-dossiers")},onError:e=>{console.error("Erreur cr\xe9ation simulation:",e)}})}(),[y,b]=(0,g.useState)([]),[j,v]=(0,g.useState)([]),[S,C]=(0,g.useState)(),[q,w]=(0,g.useState)(!1),E=(0,g.useMemo)(()=>t?.findIndex(e=>e.id==S?.id.split(".")[0])??0,[t,S]),I=(0,g.useMemo)(()=>E/(t?.length??1),[t,E]);function k(){let e=M.pop();e&&C(e)}function A(){let e=document.getElementById("main-scroll");e?.scrollTo({top:0})}return(0,s.jsxs)(m.xu,{h:{base:"calc(100vh - 60px)",lg:"calc(100vh - 100px)"},position:"relative",pt:{base:5,lg:10},children:[r&&s.jsx(P.Z,{h:"full",children:"Chargement du simulateur..."}),!r&&!q&&S&&(0,s.jsxs)(h.k,{flexDir:"column",textAlign:"center",alignItems:"center",h:"full",children:[s.jsx(F,{progress:I}),s.jsx(z,{onNext:async e=>{e&&["select","select-multi"].includes(S.type)&&await (0,W._)(200),function(e){if(!S||!t||void 0==e)return;let r={id:S.id,type:S.type,value:e};if(b(e=>D(e,r)),v(e=>D(e,r)),M.length>0){k();return}let s=S.dependencies;S.idfDependencies&&function(e){let t=e.find(e=>"type-occupant.proprio-second.code-postal"==e.id)?.value.toString();if(!t)try{t=JSON.parse(e.find(e=>"adresse"==e.id)?.value.toString()??"{}").zipCode}catch(e){console.error(e)}return!!t&&["75","77","78","91","92","93","94","95"].includes(t[0]+t[1])}(y)&&(s=S.idfDependencies);let i=[];if(Array.isArray(e))for(let t of e){let e=s?.[t];e&&i.push(...e.map(e=>({...e,id:`${S.id}.${t}.${e.id}`})))}else{let t=s?.[e.toString()];t?.length&&i.push(...t.map(t=>({...t,id:`${S.id}.${e}.${t.id}`})))}i.length?(M=[...i].reverse(),k()):t.length-1>E&&C(t[E+1]),A()}(e??j.find(e=>e.id==S?.id)?.value)},simulatorResult:y,displayOnNext:void 0!=j.find(e=>e.id==S.id),onPrevious:E>0?function(){if(!t)return;let e=y[y.length-1];if(e.id.includes(".")){let[r,s,i]=e.id.split("."),n=t.find(e=>e.id==r)?.dependencies?.[s].find(e=>e.id==i);if(!n)return;S?.id.includes(".")&&M.push(S),C({...n,id:e.id})}else C(t.find(t=>t.id==e.id)),M=[];b(t=>t.filter(t=>t.id!=e.id)),A()}:void 0,defaultValue:j.find(e=>e.id==S.id)?.value,onEnd:function(){f({simulation:y},{onSuccess(){e.push("/app/mon-compte/mes-dossiers")},onError(){w(!0)}})},...S})]})]})}function $(){return s.jsx(T,{})}},61383:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>o,__esModule:()=>n,default:()=>l});var s=r(68570);let i=(0,s.createProxy)(String.raw`C:\Users\Reunion2\Desktop\test-pay\front\src\app\simulateur\page.tsx`),{__esModule:n,$$typeof:o}=i;i.default;let l=(0,s.createProxy)(String.raw`C:\Users\Reunion2\Desktop\test-pay\front\src\app\simulateur\page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9351],()=>r(79674));module.exports=s})();